\documentclass[12pt]{article}

\input{4mbapreamble}
\input{4mba2q}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FANCY HEADER AND FOOTER STUFF %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fancyhdr,lastpage}
\pagestyle{fancy}
\fancyhf{} % clear all header and footer parameters
%%%\lhead{Student Name: \theblank{4cm}}
%%%\chead{}
%%%\rhead{Student Number: \theblank{3cm}}
%%%\lfoot{\small\bfseries\ifnum\thepage<\pageref{LastPage}{CONTINUED\\on next page}\else{LAST PAGE}\fi}
\lfoot{}
\cfoot{{\small\bfseries Page \thepage\ of \pageref{LastPage}}}
\rfoot{}
\renewcommand\headrulewidth{0pt} % Removes funny header line
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{Sweave}
\begin{document}
\input{TheInfectiveCollective_4MB3_A2-concordance}
%\SweaveOpts{concordance=TRUE}

\begin{center}
{\bf Mathematics 4MB3/6MB3 Mathematical Biology\\
\smallskip
2018 ASSIGNMENT 2}\\
\medskip
\underline{\emph{Group Name}}: \texttt{{\color{blue}The Infective Collective}}\\
\medskip
\underline{\emph{Group Members}}: {\color{blue}Aurora Basinski-Ferris, Michael Chong, Daniel Park, Daniel Presta}
\end{center}

\bigskip
\noindent
This assignment was due in class on \textcolor{red}{\bf Monday 5 February 2018 at 11:30am}.

\section{Plot P\&I mortality in Philadelphia in 1918}

\begin{enumerate}[(a)]

\item \PhilaDataReceived

\item \PhilaDataReadA
\begin{Schunk}
\begin{Sinput}
> datafile <- "pim_us_phila_city_1918_dy.csv"
> philadata <- read.csv(datafile)
> philadata$date <- as.Date(philadata$date)
\end{Sinput}
\end{Schunk}
\PhilaDataReadB

\item \PhilaDataReproduceA
  {\color{blue} \begin{proof}[Solution]
  {\color{magenta}
\begin{Schunk}
\begin{Sinput}
> ## first make the box with no annotation or curves
> # don't actually plot anything
> plot(philadata$date, philadata$pim, type="n", 
+      bty="L", # no upper or right box lines
+      ylim=c(0,800), # axis limits
+      yaxp=c(0,800,4), #first two numbers is coordinates of 
+                       #extreme tick marks, third number is the number of marks
+      xaxt='n', #supress x ticks and labels
+      xlab="",
+      ann=FALSE, # no axis annotation (i.e., no title or axis labels)
+      xaxs="i", #first tick on x axis is the y axis
+      las=1 # axis label style: always horizontal
+ )
> month <- c(9,10,11,12) #want sept, oct, nov, dec labels
> ticks <- seq(philadata$date[1],
+              philadata$date[length(philadata$date)], by="months") 
> #put ticks where we want them and labels
> axis(1, at = ticks, labels = month.abb[month], tcl = -0.3) 
> ## creat label for axes
> #putting x label 'Date' on
> mtext("Date", side=1, adj=1, line=1.5, font=1, cex=1.75, col="blue") 
> mtext("P&I Deaths", side=2, at=900, 
+       line=-4, font=1, las=1, cex=1.75, col="blue")
> # putting y label on
> # at =900 is because it is at around 900 on the y axis plot (just above the top which is 800)
> # font=1 means normal font (not italics or bold)
> 
> ## plot data
> #putting the grey line, lwd gives line thickness relativ to default
> lines(philadata, col="grey", lwd=1.75) 
> #putting the red points
> points(philadata$date, philadata$pim, pch=21, bg="red") 
\end{Sinput}
\end{Schunk}
  }
  \end{proof}
  }

\PhilaDataReproduceB

\end{enumerate}

\section{Estimate $\R_0$ from the Philadelphia P\&I time series}

\begin{enumerate}[(a)]

\item \EstimateRna

 {\color{blue} \begin{proof}[Solution]
 {\color{magenta}
 Let mortality be denoted by $M(t)$ and prevalence be denoted by $I(t)$. If we assume that both mortality and prevalence grow exponentially, then we can write
\begin{equation*}
\begin{aligned}
M(t) = a e^{bt}
\end{aligned}
\end{equation*}
and
\begin{equation*}
\begin{aligned}
I(t) = g e^{ht}
\end{aligned}
\end{equation*}
for some constants $a$, $b$, $g$, and $h$. Furthermore, if we assume that $I(t) = \eta M(t - \tau)$, for some $\eta$ and $\tau$, then we can write
\begin{equation*}
\begin{aligned}
g e^{ht} = I(t) = \eta M(t - \tau) = \eta a e^{bt}.
\end{aligned}
\end{equation*}
Then $g e^{ht} = \eta a e ^{bt}$, and
\begin{equation*}
\begin{aligned}
e^{(h-b)t} = \frac{\eta a }{g}.
\end{aligned}
\end{equation*}
Notice that the RHS of this equation is constant and thus forces $h - b = 0$. That is, $h=b$, and thus both $I(t)$ and $M(t)$ have the same exponential growth rate.
}
 \end{proof}
 }

\item \EstimateRnb

  {\color{blue} \begin{proof}[Solution]
  {\color{magenta}
  \leavevmode
  <<estimaternb, warning=FALSE, message=FALSE, fig.height=8, fig.height=5>>==
library(tidyverse)
library(ggplot2); theme_set(theme_bw())

philadata <- philadata  %>% 
    mutate(day = as.numeric(date) - min(as.numeric(philadata$date))) #R stored dates as -18000. transformed so first date sept 1918 is 0
x <- philadata %>%
    filter(date <= "1918-10-7" & date >= "1918-09-15") #filter data in linear region


lm.base.e <- lm(log(pim)~day, data= x) #generates lm and gives slope in base e

x <- x %>%
    mutate(expected= exp(lm.base.e$coefficients[1])*exp(lm.base.e$coefficients[2]*day))

ggplot(philadata, aes(x=date, y=log(pim))) +
    geom_point() +
    annotate(geom="rect", xmin = as.Date("1918-10-7"), xmax = as.Date("1918-09-15"), ymin =0, ymax=Inf, alpha=0.2) +
    labs(x="Date", y="log(P&I Mortality)") +
    geom_line(data=x, aes(x=date, y=log(expected)), color="tomato3")

ggplot(philadata, aes(x=date, y=pim)) +
    geom_point() +
    annotate(geom="rect", xmin = as.Date("1918-10-7"), xmax = as.Date("1918-09-15"), ymin =0, ymax=Inf, alpha=0.2) +
    labs(x="Date", y="P&I Mortality") +
    geom_line(data=x, aes(x=date, y=expected), color="tomato3")

